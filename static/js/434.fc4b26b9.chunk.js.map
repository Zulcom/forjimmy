{"version":3,"file":"static/js/434.fc4b26b9.chunk.js","mappings":"uJAAO,MAAMA,EAAiB,c,2DCMf,MAAMC,EAAgD,cAAD,KACzDC,KAAO,kBADkD,KAEhEC,QAA4B,CAAEC,KAAM,GAAIC,QAAS,EAAGC,WAAY,KAFA,KAGxDC,cAAgB,IAAM,IAAIC,gBAAgBR,EAAAA,eAHc,CAK5DS,WAAOC,GACPC,KAAKR,QAAUO,CAClB,CAGOE,WAAWC,GAAyD,IAAjCC,EAAgC,uDAAtB,EACjD,OAAOC,OAAOC,MAAMH,GAAKI,OAAMC,IAC3B,GAAIJ,GAAWH,KAAKR,QAAQE,QACxB,MAAMa,EAGV,OADAC,QAAQC,MAAO,gCAA+BP,qCAAuCC,EAAU,KACxF,IAAIO,SAAQC,GAAWC,YAAW,IAAMD,EAAQX,KAAKC,WAAWC,IAAOC,KAAWH,KAAKR,QAAQG,aAAtG,GAEP,CAEOU,MAASH,GAEb,OADAM,QAAQC,MAAO,iCAAiCP,GACzCF,KAAKC,WAAWD,KAAKR,QAAQC,KAAOS,GACtCW,MAAMC,IAEH,GADAN,QAAQC,MAAO,+BAA8BP,kBAAqBY,IAC7DA,EAAIC,GACL,MAAM,IAAIC,MAAMF,EAAIG,YAExB,OAAOH,EAAII,MAAX,IAEHZ,OAAOC,IAEJ,MADAC,QAAQW,MAAM,oBAAqBZ,GAC7BA,CAAN,GAEX,CAEOa,UAAUrB,GACd,GAAKA,EAEE,CACH,MAAMsB,EAASrB,KAAKJ,gBACpB,IAAK,IAAI0B,KAASC,OAAOC,QAAQzB,GAC7BsB,EAAOI,UAAUH,GAErB,MAAO,IAAMD,EAAOK,UACvB,CAPG,OAAOrC,EAAAA,cAQd,CAEDsC,oBAA+D,IAA7CC,EAA4C,uDAArC,EACrB,OAAO5B,KAAKK,MAA+B,sBAAwBL,KAAKoB,UAAU,CAAEQ,KAAMC,OAAOD,KACpG,CAEDE,wBAAwBC,GACpB,OAAO/B,KAAKK,MAAwB,0BAAyB0B,IAAO/B,KAAKoB,YAC5E,CAEDY,qBAAqBD,GACjB,OAAO/B,KAAKK,MAAwC,0BAAyB0B,IAAO/B,KAAKoB,YAC5F,CAEDa,oBAAoBF,GAChB,OAAO/B,KAAKK,MAAyB,sBAAqB0B,IAAO/B,KAAKoB,YACzE,E","sources":["api/NHTSAVehicleAPI/constants.js","api/NHTSAVehicleAPI/index.ts"],"sourcesContent":["export const DEFAULT_PARAMS = \"?format=json\"","import { ExtendedManufacturer, Make, Manufacturer, Model } from \"../../types\";\r\nimport { APISchema } from \"../interfaces/APISchema\";\r\nimport { VehicleAPI, VehicleAPIConfig } from \"../interfaces/VehicleAPI\";\r\nimport { Service } from \"../../ioc/Service\";\r\nimport { DEFAULT_PARAMS } from \"./constants\";\r\n\r\nexport default class NHTSAVehicleAPI implements Service, VehicleAPI {\r\n    public name = 'NHTSAVehicleAPI'\r\n    _config: VehicleAPIConfig = { base: '', retries: 5, retryDelay: 1000 };\r\n    private paramsFactory = () => new URLSearchParams(DEFAULT_PARAMS);\r\n\r\n    set config(value: VehicleAPIConfig) {\r\n        this._config = value as VehicleAPIConfig\r\n    }\r\n\r\n\r\n    private fetchRetry(url: RequestInfo | URL, attempt = 1): Promise<Response> {\r\n        return window.fetch(url).catch(err => {\r\n            if (attempt >= this._config.retries) {\r\n                throw err;\r\n            }\r\n            console.debug(`[API] Response error for url ${url} handled, scheduled new attempt #${attempt + 1}`)\r\n            return new Promise(resolve => setTimeout(() => resolve(this.fetchRetry(url, ++attempt)), this._config.retryDelay))\r\n        });\r\n    }\r\n\r\n    private fetch<T>(url: RequestInfo | URL): Promise<T> {\r\n        console.debug(`[API] Started API call for url`, url)\r\n        return this.fetchRetry(this._config.base + url)\r\n            .then((res) => {\r\n                console.debug(`[API] Finished API call for ${url} with response`, res)\r\n                if (!res.ok) {\r\n                    throw new Error(res.statusText)\r\n                }\r\n                return res.json() as Promise<T>\r\n            })\r\n            .catch((err) => {\r\n                console.error('[API] Fetch error', err)\r\n                throw err\r\n            })\r\n    }\r\n\r\n    private urlParams(value?: { [name: string]: string }): string {\r\n        if (!value) {\r\n            return DEFAULT_PARAMS\r\n        } else {\r\n            const params = this.paramsFactory();\r\n            for (let entry of Object.entries(value)) {\r\n                params.append(...entry)\r\n            }\r\n            return '?' + params.toString()\r\n        }\r\n    }\r\n\r\n    loadManufacturers(page = 1): Promise<APISchema<Manufacturer>> {\r\n        return this.fetch<APISchema<Manufacturer>>('getallmanufacturers' + this.urlParams({ page: String(page) }))\r\n    }\r\n\r\n    loadMakeForManufacturer(id: number): Promise<APISchema<Make>> {\r\n        return this.fetch<APISchema<Make>>(`GetMakeForManufacturer/${id}` + this.urlParams());\r\n    }\r\n\r\n    loadManufacturerById(id: number): Promise<APISchema<ExtendedManufacturer>> {\r\n        return this.fetch<APISchema<ExtendedManufacturer>>(`GetWMIsForManufacturer/${id}` + this.urlParams());\r\n    }\r\n\r\n    loadModelsForMakeId(id: number): Promise<APISchema<Model>> {\r\n        return this.fetch<APISchema<Model>>(`GetModelsForMakeId/${id}` + this.urlParams());\r\n    }\r\n\r\n\r\n}\r\n\r\n"],"names":["DEFAULT_PARAMS","NHTSAVehicleAPI","name","_config","base","retries","retryDelay","paramsFactory","URLSearchParams","config","value","this","fetchRetry","url","attempt","window","fetch","catch","err","console","debug","Promise","resolve","setTimeout","then","res","ok","Error","statusText","json","error","urlParams","params","entry","Object","entries","append","toString","loadManufacturers","page","String","loadMakeForManufacturer","id","loadManufacturerById","loadModelsForMakeId"],"sourceRoot":""}